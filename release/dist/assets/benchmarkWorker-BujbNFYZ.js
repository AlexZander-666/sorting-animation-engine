(function(){"use strict";const l={Bubble:"bubble",Selection:"selection",Insertion:"insertion",Quick:"quick",Merge:"merge",Heap:"heap",ExternalMerge:"externalMerge"},m=2e5;class c{array;steps=[];comparisons=0;swaps=0;startTime=0;duration=0;auxiliarySpace=0;constructor(t){this.array=[...t]}run(t){return this.reset(t),this.sort(t),this.duration=performance.now()-this.startTime,t?this.steps:[]}getStats(){return{algorithmName:this.constructor.name,comparisons:this.comparisons,swaps:this.swaps,executionTime:this.duration,memoryUsage:this.array.length*8+this.auxiliarySpace}}reset(t){this.steps=t?[]:this.steps,this.comparisons=0,this.swaps=0,this.startTime=performance.now(),this.auxiliarySpace=0}ensureCapacity(t){if(t&&this.steps.length>=m)throw new Error(`动画步骤数量超过限制 (${m})，请减小输入规模。`)}pushStep(t,e){e&&(this.ensureCapacity(!0),this.steps.push(t))}compare(t,e,s){return this.comparisons++,this.pushStep({type:"compare",indices:[t,e]},s),this.array[t]-this.array[e]}swap(t,e,s){this.swaps++,this.pushStep({type:"swap",indices:[t,e]},s);const i=this.array[t];this.array[t]=this.array[e],this.array[e]=i}overwrite(t,e,s){this.swaps++,this.pushStep({type:"overwrite",index:t,value:e},s),this.array[t]=e}}class f extends c{sort(t){const e=this.array.length;for(let s=0;s<e-1;s+=1)for(let i=0;i<e-s-1;i+=1)this.compare(i,i+1,t)>0&&this.swap(i,i+1,t)}}class w extends c{MEMORY_CAPACITY=10;sort(t){if(this.array.length===0)return;const e=this.MEMORY_CAPACITY,s=[];for(let r=0;r<this.array.length;r+=e){const a=this.array.slice(r,r+e);this.ensureMemoryCapacity(a.length),s.push(a)}this.auxiliarySpace=Math.max(this.auxiliarySpace,this.MEMORY_CAPACITY*8),this.pushStep({type:"splitToChunks",chunks:s.map(r=>[...r])},t);const i=s.map((r,a)=>{this.pushStep({type:"loadChunkToMemory",chunkId:a,data:[...r]},t);const n=[...r].sort((o,p)=>(this.comparisons++,o-p));return this.ensureMemoryCapacity(n.length),n.forEach((o,p)=>{this.pushStep({type:"writeToDisk",chunkId:a,index:p,value:o},t)}),n});this.multiWayMerge(i,t)}ensureMemoryCapacity(t){if(t>this.MEMORY_CAPACITY)throw new Error(`单个数据块大小 (${t}) 超出内存缓冲区上限 ${this.MEMORY_CAPACITY}，请减少输入规模。`)}multiWayMerge(t,e){const s=new Array(t.length).fill(0),i=t.reduce((a,n)=>a+n.length,0),r=t.length;for(let a=0;a<i;a+=1){let n=-1,o=1/0;const p=[];if(t.forEach((y,u)=>{if(s[u]<y.length){const g=y[s[u]];p.push(u),this.comparisons++,g<o&&(o=g,n=u)}}),n===-1)break;this.pushStep({type:"loadChunkToMemory",chunkId:n,data:[t[n][s[n]]]},e),this.pushStep({type:"comparisonDetails",indices:p,winnerIndex:n},e),this.pushStep({type:"writeToDisk",chunkId:r,index:a,value:o},e),this.overwrite(a,o,e),s[n]+=1}}}class M extends c{sort(t){const e=this.array.length;for(let s=Math.floor(e/2)-1;s>=0;s-=1)this.heapify(e,s,t);for(let s=e-1;s>0;s-=1)this.swap(0,s,t),this.heapify(s,0,t)}heapify(t,e,s){let i=e;const r=2*e+1,a=2*e+2;r<t&&this.compare(r,i,s)>0&&(i=r),a<t&&this.compare(a,i,s)>0&&(i=a),i!==e&&(this.swap(e,i,s),this.heapify(t,i,s))}}class x extends c{sort(t){for(let e=1;e<this.array.length;e+=1){let s=e;for(;s>0&&this.compare(s-1,s,t)>0;)this.swap(s-1,s,t),s-=1}}}class C extends c{sort(t){this.array.length<=1||this.mergeSort(0,this.array.length-1,t)}mergeSort(t,e,s){if(t>=e)return;const i=Math.floor((t+e)/2);this.mergeSort(t,i,s),this.mergeSort(i+1,e,s),this.merge(t,i,e,s)}merge(t,e,s,i){const r=[];let a=t,n=e+1;for(;a<=e&&n<=s;)this.compare(a,n,i)<=0?(r.push(this.array[a]),a+=1):(r.push(this.array[n]),n+=1);for(;a<=e;)r.push(this.array[a]),a+=1;for(;n<=s;)r.push(this.array[n]),n+=1;this.auxiliarySpace=Math.max(this.auxiliarySpace,r.length*8),r.forEach((o,p)=>{this.overwrite(t+p,o,i)})}}class S extends c{sort(t){this.quickSort(0,this.array.length-1,t)}quickSort(t,e,s){if(t<e){const i=this.partition(t,e,s);this.quickSort(t,i-1,s),this.quickSort(i+1,e,s)}}partition(t,e,s){const i=e;let r=t-1;for(let a=t;a<e;a+=1)this.compare(a,i,s)<=0&&(r+=1,this.swap(r,a,s));return this.swap(r+1,e,s),r+1}}class T extends c{sort(t){const e=this.array.length;for(let s=0;s<e-1;s+=1){let i=s;for(let r=s+1;r<e;r+=1)this.compare(r,i,t)<0&&(i=r);i!==s&&this.swap(s,i,t)}}}const k=(h,t)=>{switch(h){case l.Bubble:return new f(t);case l.Selection:return new T(t);case l.Insertion:return new x(t);case l.Quick:return new S(t);case l.Merge:return new C(t);case l.Heap:return new M(t);case l.ExternalMerge:default:return new w(t)}};self.onmessage=h=>{const{jobId:t,jobs:e}=h.data,s=e.map(r=>{try{const a=k(r.algorithm,r.data);return a.run(!1),{...a.getStats(),algorithmType:r.algorithm}}catch(a){return{algorithmName:r.algorithm,comparisons:0,swaps:0,executionTime:0,memoryUsage:0,algorithmType:r.algorithm,error:a instanceof Error?a.message:"未知错误",skipped:!0}}}),i={jobId:t,results:s};self.postMessage(i)}})();
